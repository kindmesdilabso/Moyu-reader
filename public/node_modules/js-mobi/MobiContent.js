"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.MobiContentType = void 0;
var MobiContentIndex_1 = __importDefault(require("js-mobi/MobiContentIndex"));
var utils_1 = require("js-mobi/utils");
var MobiContentType;
(function (MobiContentType) {
    MobiContentType[MobiContentType["HEADER"] = 0] = "HEADER";
    MobiContentType[MobiContentType["CONTENT"] = 1] = "CONTENT";
    MobiContentType[MobiContentType["INDEX"] = 2] = "INDEX";
    MobiContentType[MobiContentType["TAGX"] = 3] = "TAGX";
    MobiContentType[MobiContentType["TAG"] = 4] = "TAG";
    MobiContentType[MobiContentType["IDXT"] = 5] = "IDXT";
    MobiContentType[MobiContentType["FLIS"] = 6] = "FLIS";
    MobiContentType[MobiContentType["FCIS"] = 7] = "FCIS";
    MobiContentType[MobiContentType["FDST"] = 8] = "FDST";
    MobiContentType[MobiContentType["DATP"] = 9] = "DATP";
    MobiContentType[MobiContentType["SRCS"] = 10] = "SRCS";
    MobiContentType[MobiContentType["CMET"] = 11] = "CMET";
    MobiContentType[MobiContentType["AUDI"] = 12] = "AUDI";
    MobiContentType[MobiContentType["VIDE"] = 13] = "VIDE";
    MobiContentType[MobiContentType["END_OF_TEXT"] = 14] = "END_OF_TEXT";
    MobiContentType[MobiContentType["COVER"] = 15] = "COVER";
    MobiContentType[MobiContentType["THUMBNAIL"] = 16] = "THUMBNAIL";
    MobiContentType[MobiContentType["IMAGE"] = 17] = "IMAGE";
    MobiContentType[MobiContentType["UNKNOWN"] = 18] = "UNKNOWN";
})(MobiContentType = exports.MobiContentType || (exports.MobiContentType = {}));
var MobiContent = /** @class */ (function () {
    function MobiContent(_a) {
        var content = _a.content, type = _a.type;
        this.content = content;
        this.type = type;
    }
    MobiContent.evaluateType = function (pdbHeader, palmHeader, mobiContentHeader, index, content) {
        if (utils_1.isContentRecord(palmHeader, index)) {
            return MobiContentType.CONTENT;
        }
        else if (utils_1.isIndexRecord(content)) {
            return MobiContentType.INDEX;
        }
        else if (utils_1.isEndOfTextRecord(palmHeader, index, content)) {
            return MobiContentType.END_OF_TEXT;
        }
        else if (utils_1.isTagxRecord(content)) {
            return MobiContentType.TAGX;
        }
        else if (utils_1.isFlisRecord(content)) {
            return MobiContentType.FLIS;
        }
        else if (utils_1.isFcisRecord(content)) {
            return MobiContentType.FCIS;
        }
        else if (utils_1.isFdstRecord(content)) {
            return MobiContentType.FDST;
        }
        else if (utils_1.isDatpRecord(content)) {
            return MobiContentType.DATP;
        }
        else if (utils_1.isSrcsRecord(content)) {
            return MobiContentType.SRCS;
        }
        else if (utils_1.isCmetRecord(content)) {
            return MobiContentType.CMET;
        }
        else if (utils_1.isAudiRecord(content)) {
            return MobiContentType.AUDI;
        }
        else if (utils_1.isVideRecord(content)) {
            return MobiContentType.VIDE;
        }
        else if (utils_1.isCover(mobiContentHeader, index)) {
            return MobiContentType.COVER;
        }
        else if (utils_1.isThumbnail(mobiContentHeader, index)) {
            return MobiContentType.THUMBNAIL;
        }
        else if (utils_1.isImage(content)) {
            return MobiContentType.IMAGE;
        }
        return MobiContentType.UNKNOWN;
    };
    MobiContent.readMobiContent = function (uint8, pdbHeader, palmHeader, mobiContentHeader) {
        var mobiContents = [];
        var records = pdbHeader.records || [];
        for (var i = 1; i < records.length; i++) {
            mobiContents.push(MobiContent.createMobiContent(pdbHeader, palmHeader, mobiContentHeader, uint8, i));
        }
        return mobiContents;
    };
    MobiContent.createMobiContent = function (pdbHeader, palmHeader, mobiContentHeader, uint8, index) {
        var _a, _b, _c, _d, _e;
        var recordDataOffset = (_b = (_a = pdbHeader.records) === null || _a === void 0 ? void 0 : _a[index]) === null || _b === void 0 ? void 0 : _b.recordDataOffset;
        var nextRecordDataOffset = (_e = (_d = (_c = pdbHeader.records) === null || _c === void 0 ? void 0 : _c[index + 1]) === null || _d === void 0 ? void 0 : _d.recordDataOffset) !== null && _e !== void 0 ? _e : recordDataOffset;
        var type = MobiContent.evaluateType(pdbHeader, palmHeader, mobiContentHeader, index, uint8.slice(recordDataOffset, nextRecordDataOffset));
        var mobiContent = uint8.slice(recordDataOffset, nextRecordDataOffset);
        if (type === MobiContentType.INDEX) {
            return new MobiContentIndex_1.default(mobiContent, type);
        }
        return new MobiContent({ content: mobiContent, type: type });
    };
    return MobiContent;
}());
exports.default = MobiContent;
//# sourceMappingURL=MobiContent.js.map